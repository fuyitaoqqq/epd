<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.ibeaver.dao.ModuleMapper">

    <resultMap id="modules" type="module">
        <id column="id" property="id" />
        <result column="name" property="name" />
        <result column="api_list" property="apiList" />
        <result column="project_id" property="projectId" />
        <result column="create_time" property="createTime" />
        <result column="update_time" property="updateTime" />
    </resultMap>
    
    <sql id="moduleAllColumns" >
        id, name, uri, description, api_list, project_id, create_time, update_time
    </sql>

    <sql id="moduleAllColumnsExceptId" >
        name, uri, description, api_list, project_id, create_time, update_time
    </sql>


    <insert id="addModule" parameterType="module">
      INSERT INTO epd.module
        (<include refid="moduleAllColumnsExceptId" />)
      VALUES
        (#{name}, #{apiList}, #{projectId}, #{createTime}, #{updateTime})
    </insert>
    
    <select id="getModulesByProjectId" resultMap="modules">
        select <include refid="moduleAllColumns" /> FROM epd.module
    </select>

    <delete id="deleteModuleById">
        DELETE FROM epd.module WHERE id=#{id} and project_id=#{projectId}
    </delete>
    
    <select id="getModuleByIdAndProjectId" resultType="module">
        SELECT <include refid="moduleAllColumns" /> FROM epd.module
        WHERE id=#{id} and project_id=#{projectId}
    </select>

    <update id="updateModule" parameterType="module">
        UPDATE epd.module
        <trim suffixOverrides=",">
            <set>
                <if test="name != null and name.length() > 0">
                    name=#{name},
                </if>
                <if test="uri != null and uri.length() > 0">
                    uri=#{uri},
                </if>
                <if test="description != null and description.length() > 0">
                    description=#{description},
                </if>
                <if test="apiList != null and apiList.length() > 0">
                    api_list=#{apiList},
                </if>
                <if test="updateTime != null">
                    update_time=#{updateTime},
                </if>
            </set>
        </trim>
        WHERE id=#{id} and project_id=#{projectId}
    </update>
    
</mapper>